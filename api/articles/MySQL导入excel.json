{"title":"MySQL导入excel与报错指南","slug":"MySQL导入excel","date":"2018-02-14T08:48:08.000Z","updated":"2018-04-06T08:11:46.126Z","comments":true,"path":"api/articles/MySQL导入excel.json","excerpt":"今天是二月十四，传说中的情人节，在这样一个美好的日子里，不如一起来干一点有意义的事情，比如:在 Mac 上为 MySQL 导入 excel 数据 🌚","covers":["/media/secure.png"],"content":"<!-- build time:Sat Apr 14 2018 09:53:01 GMT+0800 (CST) --><blockquote><p>今天是二月十四，传说中的情人节，在这样一个美好的日子里，不如一起来干一点有意义的事情，比如:在 Mac 上为 MySQL 导入 excel 数据 🌚</p></blockquote><a id=\"more\"></a><h2 id=\"基本步骤\"><a class=\"markdownIt-Anchor\" href=\"#基本步骤\"></a> <strong>基本步骤</strong></h2><hr><h3 id=\"创建-table\"><a class=\"markdownIt-Anchor\" href=\"#创建-table\"></a> 创建 TABLE</h3><p>使用 CREATE TABLE 语句:</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `tablename`(</span><br><span class=\"line\">`id_name` int NOT NULL auto_increment primary key,</span><br><span class=\"line\">`content_name` varchar(20) NOT NULL</span><br><span class=\"line\">)ENGING=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure><p>关键元素:</p><ul><li>tablename 　表名</li><li>id_name content_name 　列名</li><li>int varchar 　数据类型</li><li>primary key 　主键</li></ul><p>可选元素：</p><ul><li>NOT NULL 　不允许 NULL 值</li><li>auto_increment 　自动匹配可用主键值，仅为主键可选项</li></ul><p>其他:</p><ul><li>ENGING 　引擎</li><li>CHARSET 编码，最好是 UTF-8</li></ul><p>创建时应该关注导入数据的数据类型。</p><h3 id=\"导入命令\"><a class=\"markdownIt-Anchor\" href=\"#导入命令\"></a> 导入命令</h3><p>使用 load 语句:</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOAD DATA INFILE &quot;your excel file path&quot; INTO TABLE [tablename] fields terminated by &apos;\\t&apos;;</span><br></pre></td></tr></table></figure><ul><li>path 　需要绝对路径</li><li>DATA 　后面可以加 LOCAL，表示本地客户机文件</li><li>如果必要，在 fields 前面加 编码设置 character set utf8</li><li>fields terminated by 　表示制表符，视情况而定</li></ul><h2 id=\"建议\"><a class=\"markdownIt-Anchor\" href=\"#建议\"></a> <strong>建议</strong></h2><hr><p>下面的建议也许帮忙避免一些不必要的麻烦:</p><ul><li>将 xls 文件转为 TXT 或者 CSV 文件再导入</li><li>将导入文件储存为 UTF8 格式</li><li>注意文件的制表符分割，在选取制表符分割是建议是‘,’</li></ul><h2 id=\"报错处理\"><a class=\"markdownIt-Anchor\" href=\"#报错处理\"></a> <strong>报错处理</strong></h2><hr><p>乍看语法是很简单的，但是报错很扎心啊 QAQ</p><h3 id=\"permission-denied\"><a class=\"markdownIt-Anchor\" href=\"#permission-denied\"></a> Permission denied</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(13,u&apos;at line 1: Cant get stat of `your excel file path`&apos;)</span><br></pre></td></tr></table></figure><p>读取权限不够，尝试使用<code>LOAD DATA LOCAL INFILE</code></p><h3 id=\"配置问题\"><a class=\"markdownIt-Anchor\" href=\"#配置问题\"></a> 配置问题</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1290, u&apos;The MySQL server is running with the --secure-file-priv option so it cannot execute this statement&apos;)</span><br></pre></td></tr></table></figure><p>这是由于数据导入导出操作功能配置出现了问题,输入：</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &apos;%secure%&apos;;</span><br></pre></td></tr></table></figure><p>然后看到<br><img src=\"/media/secure.png\" alt=\"secure\"></p><p>secure-file-prive 为 NULL 的意思是不支持文件导入/出在~目录查找有没有 my.cnf,没有的话创建一个,然后在[mysqld]处添加：secure_file_priv=/tmp/mysqldata。将文件放在 secure-file-prive 路径下，就可以正常导入导出了。</p><blockquote><p>这里提供一个小技巧,终端输入：</p></blockquote><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql --help | more</span><br></pre></td></tr></table></figure><blockquote><p>找到如： <img src=\"/media/option.png\" alt=\"option\"></p></blockquote><blockquote><p>其中列举的是配置文件的合法路径</p></blockquote><p>然后重启 MySQL 生效</p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql.server restart</span><br></pre></td></tr></table></figure><h3 id=\"配置文件不生效\"><a class=\"markdownIt-Anchor\" href=\"#配置文件不生效\"></a> 配置文件不生效</h3><p>重启后也许会出现：</p><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_print_default<span class=\"variable\">s:</span> [Warning] World-writable config <span class=\"keyword\">file</span> <span class=\"string\">'/Users/bitcoin/.my.cnf'</span> <span class=\"keyword\">is</span> ignored.</span><br></pre></td></tr></table></figure><p>这里是说配置文件权限太高不安全，系统自动忽略了给 🌚，权限改为 664 即可:</p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 644 /etc/my.cnf</span><br></pre></td></tr></table></figure><p>664 为该用户可读写，其他用户只可读</p><h3 id=\"编码问题\"><a class=\"markdownIt-Anchor\" href=\"#编码问题\"></a> 编码问题</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1300, u&quot;Invalid utf8 character string: &apos;&apos;&quot;)</span><br></pre></td></tr></table></figure><p>编码问题有时候确实很头疼，导入 MySQL 要确保是 UTF8 格式，然而讲道理只要将 excel 另存为 UTF8 格式的 TXT 后者 CSV 格式即可。</p><blockquote><p>酱，excel 终于导入 MySQL 了 🌞，节日快乐么么哒。</p></blockquote><!-- rebuild by neat -->","categories":[{"name":"数据处理","path":"api/categories/数据处理.json"}],"tags":[{"name":"Mac","path":"api/tags/Mac.json"},{"name":"MySQL","path":"api/tags/MySQL.json"}]}