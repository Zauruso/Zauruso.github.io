var InstantClick=function(t,e){var i,n,r,o,a,s={},l={},d=!0,f={change:[]};function u(t){var e=t.indexOf("#");return-1==e?t:t.substr(0,e)}function c(t){for(;"A"!=t.nodeName;)t=t.parentNode;return t}function g(t){for(var e=0;e<f[t].length;e++)f[t][e]()}function h(e,i){var n=t.implementation.createHTMLDocument("");n.documentElement.innerHTML=i,t.documentElement.replaceChild(n.body,t.body);var r=t.createElement("i");r.innerHTML=e,t.title=r.textContent}function m(t){T(c(t.target).href)}function p(t){var e=c(t.target);e.addEventListener("mouseout",b),a?(n=e.href,r=setTimeout(T,a)):T(e.href)}function y(t){t.which>1||t.metaKey||t.ctrlKey||(t.preventDefault(),C(c(t.target).href))}function b(){if(r)return clearTimeout(r),void(r=!1);!l.isPreloading||l.isPreloading&&l.isWaitingForCompletion||(l.xhr.abort(),l.isPreloading=!1,l.isWaitingForCompletion=!1)}function v(t){if(!(l.xhr.readyState<4)&&0!=l.xhr.status){l.timing.ready=+new Date-l.timing.start;var e=l.xhr.responseText,i=e.indexOf("<title");i>-1&&(l.title=e.substr(e.indexOf(">",i)+1),l.title=l.title.substr(0,l.title.indexOf("</title")));var n=e.indexOf("<body");if(n>-1){l.body=e.substr(n);var r=l.body.indexOf("</body");r>-1&&(l.body=l.body.substr(0,r));var o=u(l.url);s[o]={body:l.body,title:l.title,scrollY:o in s?s[o].scrollY:0}}else l.hasBody=!1;l.isWaitingForCompletion&&(l.isWaitingForCompletion=!1,C(l.url))}}function x(n){for(var r,a=t.getElementsByTagName("a"),s=e.protocol+"//"+e.host,l=a.length-1;l>=0;l--)(r=a[l]).target||r.hasAttribute("download")||0!=r.href.indexOf(s+"/")||r.href.indexOf("#")>-1&&u(r.href)==i||(d?r.hasAttribute("data-no-instant"):!r.hasAttribute("data-instant"))||(o?r.addEventListener("mousedown",m):r.addEventListener("mouseover",p),r.addEventListener("click",y));if(!n){var f,c,h,b,v=t.getElementsByTagName("script");for(l=0,j=v.length;l<j;l++)(f=v[l]).hasAttribute("data-no-instant")||(c=t.createElement("script"),f.src&&(c.src=f.src),f.innerHTML&&(c.innerHTML=f.innerHTML),h=f.parentNode,b=f.nextSibling,h.removeChild(f),h.insertBefore(c,b))}g("change")}function T(t){!o&&"display"in l.timing&&+new Date-(l.timing.start+l.timing.display)<100||(r&&(clearTimeout(r),r=!1),t||(t=n),l.isPreloading&&t==l.url||l.isPreloading&&l.isWaitingForCompletion||(l.isPreloading=!0,l.isWaitingForCompletion=!1,l.url=t,l.body=!1,l.hasBody=!0,l.timing={},l.timing.start=+new Date,l.xhr.open("GET",t),l.xhr.send()))}function C(n){if("display"in l.timing||(l.timing.display=+new Date-l.timing.start),r)return l.url&&l.url!=n?void(e.href=n):(T(n),void(l.isWaitingForCompletion=!0));if(!l.isPreloading||l.isPreloading&&l.isWaitingForCompletion)e.href=n;else if(l.hasBody)if(l.body){s[i].scrollY=pageYOffset,l.isPreloading=!1,l.isWaitingForCompletion=!1,h(l.title,l.body);var o=l.url.indexOf("#"),a=o>-1&&t.getElementById(l.url.substr(o+1)),d=0;if(l.url!=e.href&&a)for(;a.offsetParent;a=a.offsetParent)d+=a.offsetTop;scrollTo(0,d),history.pushState(null,null,l.url),i=u(e.href),x()}else l.isWaitingForCompletion=!0;else e.href=l.url}var L="pushState"in history;return{supported:L,init:function(){if(L){if(!i){for(var n=0;n<arguments.length;n++){var r=arguments[n];!0===r?d=!1:"mousedown"==r?o=!0:"number"==typeof r&&(a=r)}i=u(e.href),s[i]={body:t.body.outerHTML,title:t.title,scrollY:pageYOffset},l.xhr=new XMLHttpRequest,l.xhr.addEventListener("readystatechange",v),l.url=!1,l.body=!1,l.hasBody=!0,l.title=!1,l.isPreloading=!1,l.isWaitingForCompletion=!1,l.timing={},x(!0),addEventListener("popstate",function(){var t=u(e.href);t!=i&&(t in s?(s[i].scrollY=pageYOffset,i=t,h(s[t].title,s[t].body),scrollTo(0,s[t].scrollY),x()):e.href=e.href)})}}else g("change")},on:function(t,e){f[t].push(e)},debug:function(){return{currentLocationWithoutHash:i,p:l,pHistory:s,supported:L,useBlacklist:d}}}}(document,location);